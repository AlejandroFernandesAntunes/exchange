<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Money Handling and Currency Exchange in Ruby - Exchange Ruby Gem</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link rel="icon" 
          type="image/png" 
          href="images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div id="banner"><a href="http://github.com/beatrichartz/exchange" target="_blank">Fork me on GitHub</a></div>
    <div class="background"></div>
    <div class="overdub"></div>
    <div class="wrapper">
      <div class="third">
        <header>
          <h1>Exchange</h1>
          <ul class="links" id="navigation">
            <li><a href="#about">About</a></li>
            <li><a href="#installation">Installation</a></li>
            <li><a href="#basics">Basics</a></li>
            <li><a href="#conversion">Conversion</a></li>
            <li><a href="#fallbacks">Fallbacks</a></li>
            <li><a href="#formatting">Formatting</a></li>
            <li><a href="#rounding">Rounding</a></li>
            <li><a href="#arithmetics">Arithmetics</a></li>
            <li><a href="#comparison">Comparing and Sorting</a></li>
            <li><a href="#safe">Safe Operations</a></li>
            <li><a href="#typecasting">Typecasting Money</a></li>
            <li><a href="#apis">Conversion APIs</a></li>
            <li><a href="#cache">Caching</a></li>
            <li><a href="#configuration">Configuring Exchange</a></li>
            <li><a href="#ready">Ready for Production</a></li>
            <li><a href="#contributing">Contributing</a></li>
          </ul>

          <br/>
          <ul><li><a href="https://github.com/beatrichartz/exchange">Source Code</a></li>
          <li><a href="http://rubydoc.info/github/beatrichartz/exchange">Full Documentation</a></li>
          <li><a href="https://github.com/beatrichartz/exchange/issues">Issue Tracker</a></li>
          <li><a href="http://rubygems.org/gems/exchange">Exchange on Rubygems</a></li>
          <li id="badges"><a target="_blank" href="https://travis-ci.org/beatrichartz/exchange"><img src="https://travis-ci.org/beatrichartz/exchange.png?branch=master" alt="Travis Build Status"></a><a href='https://gemnasium.com/beatrichartz/exchange'><img src="https://gemnasium.com/beatrichartz/exchange.png" alt="Dependency Status" /></a><a href="https://codeclimate.com/github/beatrichartz/exchange"><img src="https://codeclimate.com/badge.png" alt="Code Climate Analysis"/></a></li></ul>

        </header>
      </div>
      <div class="two_third" id="content">
        <section id="about">
          <p>Exchange is a library helping you to deal with money in your ruby application. It features an intuitive DSL, measures to prevent floating point errors, currency conversion, typecasting, formatting options and more. It's goal is to make your life easier by dealing with money in decimal format with the precision of your choice and relieving you of most of the pitfalls involved in money handling.</p>
          <p>Exchange works with MRI 1.9, 2.0, REE as well as jRuby and Rubinius in 1.9 and 2.0 mode</p>
        </section>
        <section id="installation">
          <h3>Installation</h3>
          <pre class="brush: bash">$ gem install exchange</pre>
        </section>
        <section id="basics">
          <h3>Basics</h3>
          <p>Instantiate a currency</p>
          <pre class="brush: ruby">1.in(:usd)</pre>
          <p>You can also instantiate currencies from ISO 3166 country codes</p>
          <pre class="brush: ruby">1.in(:it) #=> same as 1.in(:eur)</pre>
          <p>Convert a currency to another</p>
          <pre class="brush: ruby">1.2.in(:eur).to(:jpy)</pre>
          <p>to_s converts the currency to a string in ISO4217-compatible format, complete with the right precision and the ISO standard currency abbreviation. You can also choose to only print the amount or to get a string with a currency symbol rather than the abbreviation by passing an argument.</p>
          <pre class="brush: ruby">220.2.in(:jpy).to_s #=> "JPY 220"
245.934.in(:usd).to_s(:amount) #=> "245.93"
245.934.in(:usd).to_s(:symbol) #=> "$245.93"</pre>
          <p>Apply any method you would apply to a normal instance of numeric. Method missing is routed to the currency value.</p>
          <pre class="brush: ruby">1.2.in(:eur).zero?</pre>
        </section>
        <section id="conversion">
          <h3>Conversion</h3>
          <p>Convert at today's rate</p>
          <pre class="brush: ruby">1.in(:usd).to(:eur)</pre>
          <p>Convert at yesterday's rate</p>
          <pre class="brush: ruby">1.2.in(:eur).to(:jpy, at: Time.now - 86400)</pre>
          <p>Currencies can be defined with a timestamp which is applied whenever a conversion takes place. In the example, the defined currency is always converted using the rates of January 2, 2000</p>
          <pre class="brush: ruby">currency = 1.2.in(:eur, at: Time.gm(2000,1,2))
currency.to(:jpy)
currency.to(:omr)</pre>
          <p>Exchange keeps a the instance the currency was converted from for information purposes</p>
          <pre class="brush: ruby">1.in(:usd).to(:eur).from == 1.in(:usd) #=> true</pre>
        </section>
        <section id="fallbacks">
          <h3>Fallbacks</h3>
          <p>Never worry if an API is shortly unavailable – Exchange provides the possibility to fall back to other conversion API's if one is currently not available or does not provide a rate for the attempted conversion. Thus it is possible to combine different API's with incomplete currency sets to have a more complete currency set. <br/><br/>The performance impact of a fallback if a rate is recognizably not provided by an API is minimal, whereas the performance impact caused by a http connection error is significantly larger. <br/><br/>The default fallback mechanism used calls the ECB API if the Xavier Media API is unavailable. If both are unavailable, an error is raised. You can set your own fallback chain using the API configuration.</p>
        </section>
        <section id="formatting">
          <h3>Formatting</h3>
          <p>Normal formatting via to_s includes the ISO4217-compatible currency code</p>
          <pre class="brush: ruby">1.in(:usd).to_s #=> "USD 1.00"</pre>
          <p>Specify the symbol format will print out the currency with a symbol. If no symbol is associated with a currency, the fallback used is the normally formatted string with the ISO4217-compatible currency code</p>
          <pre class="brush: ruby">1.2.in(:eur).to_s(:symbol) #=> "€1.40"</pre>
          <p>Specifying the amount format will print out the formatted amount only</p>
          <pre class="brush: ruby">1440.4.in(:usd).to_s(:amount) #=> "1,440.40"</pre>
          <p>Specifying the plain amount format will print out the unformatted amount only, using decimal notation</p>
          <pre class="brush: ruby">1440.4.in(:usd).to_s(:plain) #=> "1440.40"</pre>
          <p>As seen above, exchange takes care of the right format for the separators</p>
          <pre class="brush: ruby">155_000_000.in(:usd).to_s #=> "USD 155,000,000.00"</pre>
        </section>
        <section id="rounding">
          <h3>Rounding</h3>
          <p>Round, ceil or floor without an argument always rounds to the precision defined by ISO4217. Apply an argument to get rounding to a certain amount of decimals.</p>
          <pre class="brush: ruby">10.345.in(:usd).round #=> 10.35
9.999.in(:eur).floor #=> 9.99
10.345.in(:usd).round(0) #=> 10
9.999.in(:eur).floor(1) #=> 9.9</pre>
          <p>You can apply <a href="https://en.wikipedia.org/wiki/Psychological_pricing" target="_blank">psychological rounding</a> by passing the psych argument to the rounding operation</p>
          <pre class="brush: ruby">10.345.in(:usd).round(:psych) #=> 9.99
9.999.in(:eur).floor(:psych) #=> 8.99
10.345.in(:omr).ceil(:psych) #=> 10.999
76.in(:jpy).floor(:psych) #=> 69</pre>
        </section>
        <section id="arithmetics">
          <h3>Arithmetics</h3>
          <p>Use basic arithmetic operations with different types of currencies. If two different currencies are used, the currency right of the expression is converted to the currency left of the expression.</p>
          <pre class="brush: ruby">1.in(:usd) + 3.in(:usd)
5.in(:usd) - 3.in(:eur)
1000.in(:jpy) / 30.in(:usd)
7.in(:jpy) * 3.in(:usd)</pre>
        </section>
        <section id="comparison">
          <h3>Comparing and Sorting</h3>
          <p>Currencies get converted implicitly, at the time defined when instantiated</p>
          <pre class="brush: ruby">2.in(:eur) > 2.in(:usd) #=> true
2.in(:nok) &lt; 2.in(:sek) #=> false
50.in(:eur, at: '2011-1-1') == 50.in(:sek) #=> false</pre>
<p>Sorting also implicitly converts the currencies</p>
<pre class="brush: ruby">[5.in(:eur), 4.in(:usd), 4.in(:chf, at: '2010-01-01')].sort</pre>
        </section>
        <section id="safe">
          <h3>Safe operations</h3>
          <p>Operations with money are safeguarded against most floating point errors through Exchange. Upon instantiation of a currency, Exchange always converts the value to a big decimal. Additional Measures are implemented when Exchange::Money instances are used with floats in normal operations. Although BigDecimal operations are a bit slower than Float operations, the Exchange gem performs operations very efficiently. Float Operations not involving instances of Exchange::Money are left untouched.</p>
          <p>Floating Point errors in ruby</p>
          <pre class="brush: ruby">(0.29 * 50).round(0) #=> 14
(1.0e+25 - BigDecimal.new("9999999999999999900000000")) #=> 0</pre>
          <p>Correct operations with instances of Exchange::Money</p>
          <pre class="brush: ruby">(50.in(:usd) * 0.29).round(0) #=> "USD 15.00"
(0.29 * 50.in(:usd)).round(0) #=> 15
(1.0e+25 - BigDecimal.new("9999999999999999900000000").in(:usd)).round #=> 100000000</pre>
<p>Keep control over every conversion of currency in your app: if you do not want implicit conversions in arithmetic operations and comparisons to take place, you can configure Exchange to raise Errors on operations and comparisons involving multiple currencies.</p>
          <pre class="brush: ruby">Exchange.configuration.implicit_conversions = false
1.in(:eur) + 3.in(:usd) #=> raises ImplicitConversionError
1.in(:jpy) == 3.in(:chf) #=> raises ImplicitConversionError</pre>
        </section>
        <section id="typecasting">
          <h3>Typecasting</h3>
          <p>Exchange features a typecasting module for you to use with your ruby classes, which instantiates Exchange::Money from three attributes: the amount, the currency and the creation date of the price (which defaults to Time.now if not used). Using it is simple:</p>
          <pre class="brush: ruby">class Article
  # make the class method available
  #
  extend Exchange::Typecasting
  
  # any kind of attribute will work, let's have attr_accessor for demo purposes
  #
  attr_accessor :price
    
  # Install the typecasting for price
  #
  money :price, currency: :currency
    
  # let's say you have currency set in a unique place
  #
  def currency
    manager.currency
  end
end</pre>
          <p>Now, this will work:</p>
          <pre class="brush: ruby">a = Article.new
a.manager = Manager.new(currency: :eur)
a.price = 2
a.price #=> 2.in(:eur)</pre>
          <p>And also this; Exchange implicitly converts to the used currency if another than the one set is used in the assignment:</p>
          <pre class="brush: ruby">a.price = 3.in(:usd)
a.price == 3.in(:usd).to(:eur) #=> true
          </pre>
          <p>For more information about how to use the typecasting module, you can always visit the <a href="http://rubydoc.info/github/beatrichartz/exchange/Exchange/Typecasting" target="_blank">full documentation</a></p>
        </section>
        <section id="apis">
          <h3>Conversion Rate APIs</h3>
          <p>Exchange has 3 APIs built in for you to choose from, or you can easily build a custom API Extension</p>
          <ul>
            <li><a href="http://www.xavierforum.com/viewtopic.php?f=5&t=10979&sid=671a685edbfa5dbec219fbc6793d5057" target="_blank">Xaviermedia (XML API)</a></li>
            <li><a href="http://www.ecb.int/stats/exchange/eurofxref/html/index.en.html" target="_blank">European Central Bank</a></li>
            <li><a href="http://openexchangerates.org/" target="_blank">Open Exchange Rates API (There is a free plan provided)</a></li>            
          </ul>
          <p>There is also a :random option for development use. It will put out random exchange rates. This can be useful if you are not connected to the internet.</p>
          <p>To connect to a custom / private API, writing a small class is needed: <a href="http://rubydoc.info/github/beatrichartz/exchange/Exchange/ExternalAPI" target="_blank">How to connect to a custom / private API using Exchange</a></p>
        </section>
        <section id="cache">
          <h3>Caching Exchange Rates</h3>
          <p>Exchange generally stores your exchange rates in memory using instance variables of a singleton instance. For more persistent caching, you can also use 3 other provided caching solutions</p>
          <ul>
            <li>Memcached via the Dalli gem</li>
            <li>Redis via the Redis Gem</li>
            <li>Rails cache</li>
          </ul>
          <p>Please note that this gem does not list the any of these gems as explicit dependencies. If configured to use one of these caching solutions, Exchange tries to load the appropriate gem / constants and produces an error if it fails to do so / installation of the gem is needed.</p>
          <p>You can also write a caching extension supporting your custom caching solution: <a target="_blank" href="http://rubydoc.info/github/beatrichartz/exchange/Exchange/Cache">How to write your own caching extension</a></p>
        </section>
        <section id="configuration">
          <h3>Configuring</h3>
          <p>You can configure Exchange to a number of options. Configuration is a setter on the exchange module. This allows you to have different configurations, which you can then assign easily to exchange. This is how to define a configuration:</p>
          <pre class="brush: ruby">config = Exchange::Configuration.new do |c|
  c.implicit_conversions = false
  c.cache = {
    subclass: :memcached,
    host:     'yourhost',
    port:     2434, #yourport
  }
end</pre>
    <p>And this is how to assign it as the current one</p>
      <pre class="brush: ruby">Exchange.configuration = config</pre>
      <p>These are the options available with their defaults</p>
      <pre class="brush: ruby">cache: { # Takes the cache configuration as a hash, the options are:
  subclass: :memory,
    # takes an underscored symbol which is constantized 
    # on first use: :your_cache -> Exchange::Cache::YourCache
  host: nil, # The cache host for the client
  port: nil, # The cache port for the client
  expire: :daily # :hourly or :daily is available
},
api: { # Takes the conversion api configuration as a hash, the options are:
  subclass: :xavier_media,
    # takes an underscored symbol which is constantized 
    # on first use: :your_api -> Exchange::ExternalAPI::YourApi
  retries: 5, # The number of times a call to the API is retried
  app_id: nil, 
    # Some services like Open Exchange Rates require an App Id for requests
    # This is where to put it
  protocol: :http # The protocol to use for the requests
  fallback: :ecb
    # Fallback APIs to use if the requested api in :subclass is not available or does not provide any rate for the given conversion
    # takes an underscored symbol which is constantized or an array of underscored symbols
    # on first use: :your_api -> [Exchange::ExternalAPI::YourApi]
}
implicit_conversions: true
  # If set to false, operations involving multiple currencies will
  # produce errors, and no implicit conversions will take place.
</pre>
        </section>
        <section id="ready">
          <h3>Ready for Production</h3>
          <p>Exchange is production-ready. It is in use on <a href="http://rightclearing.com" target="_blank">rightclearing.com</a>, a music licensing service worth noticing. If you use this gem in production, <a href="mailto:beat.richartz@gmail.com">drop a note</a> so your app can be listed here.</p>
        <section id="contributing">
          <h3>Contributing</h3>
          <p>Please note that only open source APIs can be accepted as contributions to this gem. Private / Premium APIs have to be written as your own extension and will not be added to the gem code.
          </p>
          <ul>
            <li>Check out the latest master to make sure the feature hasn't been implemented or the bug hasn't been fixed yet.</li>
            <li>Check out the issue tracker to make sure someone already hasn't requested it and/or contributed it.</li>
            <li>Fork the project.</li>
            <li>Start a feature/bugfix branch.</li>
            <li>Commit and push until you are happy with your contribution.</li>
            <li>Make sure to add tests for it. This is important so I don't break it in a future version unintentionally.</li>
            <li>Make sure to add documentation for it. This is important so everyone else can see what your code can do.</li>
            <li>Please try not to mess with the Rakefile, version, or history. If you want to have your own version, or is otherwise necessary, that is fine, but please isolate to its own commit so I can cherry-pick around it.</li></ul>
        </section>
      </div>
      <footer>
        <p><small>Hosted on GitHub Pages</small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    <script src="javascripts/shCore.js"></script>
    <script src="javascripts/shBrushRuby.js"></script>
    <script src="javascripts/shBrushBash.js"></script>
    <script type="text/javascript">
      SyntaxHighlighter.defaults.toolbar = false;
      SyntaxHighlighter.defaults.gutter  = false;
      SyntaxHighlighter.highlight();
    </script>
    <script src="javascripts/scroll.js"></script>
    <script src="http://use.edgefonts.net/source-code-pro:n4.js"></script>
  </body>
</html>